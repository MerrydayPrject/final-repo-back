<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>합성 품질 평가 테스트 - Marryday</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .header-stats {
            position: absolute;
            top: 20px;
            right: 30px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px 25px;
            display: flex;
            gap: 30px;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .header-stats:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .header-stat-item {
            text-align: center;
        }

        .header-stat-value {
            font-size: 1.8em;
            font-weight: bold;
            display: block;
        }

        .header-stat-label {
            font-size: 0.85em;
            opacity: 0.9;
            margin-top: 5px;
        }

        .content {
            padding: 30px;
        }

        .filter-section {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .filter-section h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .filter-group {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-group label {
            font-weight: 500;
            color: #555;
        }

        .filter-group select {
            padding: 8px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-group select:hover {
            border-color: #667eea;
        }

        .stats-bar {
            display: flex;
            justify-content: space-around;
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        .quiz-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .image-section {
            background: #f9f9f9;
            border-radius: 15px;
            padding: 20px;
        }

        .image-section h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .image-info {
            margin-bottom: 15px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            font-size: 0.9em;
            color: #666;
        }

        .quiz-image {
            width: 100%;
            max-height: 500px;
            object-fit: contain;
            border-radius: 10px;
            background: white;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 15px;
        }

        .answer-section {
            background: #f9f9f9;
            border-radius: 15px;
            padding: 20px;
        }

        .answer-section h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .evaluation-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .eval-btn {
            padding: 20px;
            border: 3px solid #ddd;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.2em;
            font-weight: 600;
            color: #333;
        }

        .eval-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .eval-btn.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .eval-btn.success {
            border-color: #4caf50;
            background: #4caf50;
            color: white;
        }

        .eval-btn.failed {
            border-color: #f44336;
            background: #f44336;
            color: white;
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 15px;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .next-btn {
            width: 100%;
            padding: 15px;
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: none;
        }

        .next-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .result-message {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 600;
            display: none;
        }

        .result-message.success {
            background: #e8f5e9;
            color: #2e7d32;
            border: 2px solid #4caf50;
        }

        .result-message.failed {
            background: #ffebee;
            color: #c62828;
            border: 2px solid #f44336;
        }

        .pipeline-stats {
            background: #f9f9f9;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .pipeline-stats h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .pipeline-stats-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }

        .pipeline-stats-table th,
        .pipeline-stats-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .pipeline-stats-table th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        .pipeline-stats-table tr:hover {
            background: #f5f5f5;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .quiz-section {
                grid-template-columns: 1fr;
            }

            .evaluation-buttons {
                grid-template-columns: 1fr;
            }

            .stats-bar {
                flex-direction: column;
                gap: 15px;
            }

            .header-stats {
                position: static;
                margin-bottom: 20px;
                justify-content: center;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <div class="header-stats" onclick="loadStatistics()">
                <div class="header-stat-item">
                    <span class="header-stat-value" id="headerTotal">0</span>
                    <span class="header-stat-label">전체 평가</span>
                </div>
                <div class="header-stat-item">
                    <span class="header-stat-value" id="headerSuccess">0</span>
                    <span class="header-stat-label">성공</span>
                </div>
                <div class="header-stat-item">
                    <span class="header-stat-value" id="headerRate">0%</span>
                    <span class="header-stat-label">성공률</span>
                </div>
            </div>
            <h1>합성 품질 평가 테스트</h1>
            <p>합성이 잘 되었는지 평가해주세요!</p>
        </div>

        <div class="content">
            <div class="filter-section">
                <h3>필터</h3>
                <div class="filter-group">
                    <label for="modelFilter">파이프라인:</label>
                    <select id="modelFilter">
                        <option value="">전체</option>
                        <option value="xai-gemini-unified">xai-gemini-unified</option>
                        <option value="xai-gemini-unified-v2">xai-gemini-unified-v2</option>
                        <option value="xai-gemini-unified-v2.5">xai-gemini-unified-v2.5</option>
                        <option value="xai-gemini-unified-v3">xai-gemini-unified-v3</option>
                        <option value="xai-gemini-unified-v4">xai-gemini-unified-v4</option>
                        <option value="v5">v5</option>
                        <option value="gemini-unified-v5">gemini-unified-v5</option>
                        <option value="xai-gemini-unified-custom-v3">xai-gemini-unified-custom-v3</option>
                        <option value="xai-gemini-unified-custom-v4">xai-gemini-unified-custom-v4</option>
                        <option value="gemini-unified-custom-v5">gemini-unified-custom-v5</option>
                    </select>
                    <button class="submit-btn" onclick="loadImages()" style="width: auto; padding: 8px 20px; margin: 0;">적용</button>
                </div>
            </div>

            <div class="stats-bar">
                <div class="stat-item">
                    <div class="stat-value" id="totalCount">0</div>
                    <div class="stat-label">전체 평가</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="currentIndex">0</div>
                    <div class="stat-label">현재 항목</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="successCount">0</div>
                    <div class="stat-label">성공</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="successRate">0%</div>
                    <div class="stat-label">성공률</div>
                </div>
            </div>

            <div class="quiz-section">
                <div class="image-section">
                    <h3>합성 결과 이미지</h3>
                    <div id="imageContainer">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>이미지를 불러오는 중...</p>
                        </div>
                    </div>
                </div>

                <div class="answer-section">
                    <h3>합성이 잘 되었나요?</h3>
                    <div class="evaluation-buttons">
                        <button class="eval-btn" id="successBtn" data-success="true">예</button>
                        <button class="eval-btn" id="failedBtn" data-success="false">아니오</button>
                    </div>
                    <div class="result-message" id="resultMessage"></div>
                    <button class="submit-btn" id="submitBtn" disabled>평가 제출</button>
                    <button class="next-btn" id="nextBtn">다음 항목</button>
                </div>
            </div>

            <div class="pipeline-stats">
                <h3>파이프라인별 성공률</h3>
                <table class="pipeline-stats-table">
                    <thead>
                        <tr>
                            <th>파이프라인</th>
                            <th>전체</th>
                            <th>성공</th>
                            <th>실패</th>
                            <th>성공률</th>
                        </tr>
                    </thead>
                    <tbody id="pipelineStatsBody">
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 20px;">
                                통계를 불러오는 중...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let images = [];
        let currentImageIndex = 0;
        let selectedEvaluation = null;
        let successCount = 0;
        let totalEvaluated = 0;
        let currentModel = "";
        let viewedImageIds = new Set(); // 이미 본 이미지 IDX 추적

        // 로컬 스토리지에서 본 이미지 목록 로드
        function loadViewedImages() {
            const saved = localStorage.getItem('synthesisQualityViewedImages');
            if (saved) {
                viewedImageIds = new Set(JSON.parse(saved));
            }
        }

        // 로컬 스토리지에 본 이미지 목록 저장
        function saveViewedImages() {
            localStorage.setItem('synthesisQualityViewedImages', JSON.stringify(Array.from(viewedImageIds)));
        }

        // 이미지 리스트 로드
        async function loadImages() {
            currentModel = document.getElementById('modelFilter').value;
            const resultDiv = document.getElementById('imageContainer');
            
            // 본 이미지 목록 로드
            loadViewedImages();
            
            resultDiv.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>이미지를 불러오는 중...</p>
                </div>
            `;

            try {
                const params = new URLSearchParams();
                if (currentModel) params.append('model', currentModel);
                // limit 파라미터 제거하여 전체 조회
                params.append('offset', '0');
                params.append('include_evaluated', 'true'); // 평가된 항목도 포함하여 전체 조회

                const response = await fetch(`/api/synthesis-quality-test/images?${params.toString()}`);
                const data = await response.json();

                if (data.success) {
                    // 이미 본 이미지 제외
                    images = data.images.filter(img => !viewedImageIds.has(img.idx));
                    
                    if (images.length > 0) {
                        currentImageIndex = 0;
                        loadCurrentImage();
                    } else {
                        resultDiv.innerHTML = '<p style="text-align: center; color: #f44336; padding: 40px;">평가할 이미지가 없습니다. (모든 이미지를 확인했습니다)</p>';
                    }
                } else {
                    resultDiv.innerHTML = `<p style="text-align: center; color: #f44336; padding: 40px;">이미지를 불러올 수 없습니다: ${data.error || '알 수 없는 오류'}</p>`;
                }
            } catch (error) {
                console.error('이미지 로드 오류:', error);
                resultDiv.innerHTML = '<p style="text-align: center; color: #f44336; padding: 40px;">오류가 발생했습니다.</p>';
            }

            // 통계 업데이트
            loadStatistics();
        }

        // 현재 이미지 로드
        function loadCurrentImage() {
            if (images.length === 0) return;

            // 이미 본 이미지 건너뛰기
            while (currentImageIndex < images.length && viewedImageIds.has(images[currentImageIndex].idx)) {
                currentImageIndex++;
            }

            if (currentImageIndex >= images.length) {
                const imageContainer = document.getElementById('imageContainer');
                imageContainer.innerHTML = '<p style="text-align: center; color: #4caf50; padding: 40px; font-size: 1.2em;">✅ 모든 이미지를 확인했습니다!</p>';
                return;
            }

            const currentImage = images[currentImageIndex];
            const imageContainer = document.getElementById('imageContainer');
            
            // 현재 이미지를 본 이미지 목록에 추가
            viewedImageIds.add(currentImage.idx);
            saveViewedImages();
            
            const imageInfo = `
                <div class="image-info">
                    <strong>파이프라인:</strong> ${currentImage.model || 'N/A'}<br>
                    <strong>생성일:</strong> ${currentImage.created_at ? new Date(currentImage.created_at).toLocaleString('ko-KR') : 'N/A'}<br>
                    <strong>IDX:</strong> ${currentImage.idx}
                </div>
            `;

            // S3 URL인 경우 프록시를 통해 로드
            let imageUrl = currentImage.result_url;
            if (imageUrl && (imageUrl.includes('s3') || imageUrl.includes('amazonaws.com'))) {
                // 프록시를 통해 이미지 로드
                imageUrl = `/api/admin/s3-image-proxy?url=${encodeURIComponent(imageUrl)}`;
            }

            // 이미지 로드 실패 감지를 위한 함수
            let imageLoadFailed = false;
            const img = new Image();
            
            img.onload = function() {
                if (!imageLoadFailed) {
                    imageContainer.innerHTML = imageInfo + `
                        <img src="${imageUrl}" alt="합성 결과" class="quiz-image" 
                             onerror="handleImageError()">
                    `;
                }
            };
            
            img.onerror = function() {
                imageLoadFailed = true;
                imageContainer.innerHTML = imageInfo + `
                    <div style="padding: 40px; text-align: center; background: #ffebee; border-radius: 10px; border: 2px solid #f44336;">
                        <p style="color: #c62828; font-weight: bold; font-size: 1.2em; margin-bottom: 10px;">⚠️ 이미지 로드 실패</p>
                        <p style="color: #666; margin-bottom: 10px; word-break: break-all; font-size: 0.9em;">원본 URL: ${currentImage.result_url || 'N/A'}</p>
                        <p style="color: #666; margin-bottom: 15px; word-break: break-all; font-size: 0.9em;">프록시 URL: ${imageUrl || 'N/A'}</p>
                        <button onclick="skipFailedImage()" style="padding: 10px 20px; background: #f44336; color: white; border: none; border-radius: 5px; cursor: pointer; margin-right: 10px;">
                            다음 항목으로 건너뛰기
                        </button>
                        <button onclick="retryImageLoad()" style="padding: 10px 20px; background: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            다시 시도
                        </button>
                    </div>
                `;
            };
            
            img.src = imageUrl;

            // 상태 초기화
            selectedEvaluation = null;
            document.getElementById('successBtn').classList.remove('selected', 'success', 'failed');
            document.getElementById('failedBtn').classList.remove('selected', 'success', 'failed');
            document.getElementById('submitBtn').disabled = true;
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('resultMessage').style.display = 'none';
            
            // 통계 업데이트
            updateStats();
        }

        // 이미지 다시 로드 시도
        function retryImageLoad() {
            loadCurrentImage();
        }

        // 이미지 로드 실패 처리
        function handleImageError() {
            const currentImage = images[currentImageIndex];
            const imageContainer = document.getElementById('imageContainer');
            const imageInfo = `
                <div class="image-info">
                    <strong>파이프라인:</strong> ${currentImage.model || 'N/A'}<br>
                    <strong>생성일:</strong> ${currentImage.created_at ? new Date(currentImage.created_at).toLocaleString('ko-KR') : 'N/A'}<br>
                    <strong>IDX:</strong> ${currentImage.idx}
                </div>
            `;
            
            // S3 URL인 경우 프록시를 통해 로드
            let imageUrl = currentImage.result_url;
            if (imageUrl && (imageUrl.includes('s3') || imageUrl.includes('amazonaws.com'))) {
                imageUrl = `/api/admin/s3-image-proxy?url=${encodeURIComponent(imageUrl)}`;
            }
            
            imageContainer.innerHTML = imageInfo + `
                <div style="padding: 40px; text-align: center; background: #ffebee; border-radius: 10px; border: 2px solid #f44336;">
                    <p style="color: #c62828; font-weight: bold; font-size: 1.2em; margin-bottom: 10px;">⚠️ 이미지 로드 실패</p>
                    <p style="color: #666; margin-bottom: 10px; word-break: break-all; font-size: 0.9em;">원본 URL: ${currentImage.result_url || 'N/A'}</p>
                    <p style="color: #666; margin-bottom: 15px; word-break: break-all; font-size: 0.9em;">프록시 URL: ${imageUrl || 'N/A'}</p>
                    <button onclick="skipFailedImage()" style="padding: 10px 20px; background: #f44336; color: white; border: none; border-radius: 5px; cursor: pointer; margin-right: 10px;">
                        다음 항목으로 건너뛰기
                    </button>
                    <button onclick="retryImageLoad()" style="padding: 10px 20px; background: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        다시 시도
                    </button>
                </div>
            `;
        }

        // 실패한 이미지 건너뛰기 (이미 본 이미지 목록에 추가)
        function skipFailedImage() {
            if (images.length === 0) return;
            
            const currentImage = images[currentImageIndex];
            viewedImageIds.add(currentImage.idx);
            saveViewedImages();
            
            currentImageIndex++;
            if (currentImageIndex >= images.length) {
                // 더 이상 이미지가 없으면 다시 로드
                loadImages();
            } else {
                loadCurrentImage();
            }
        }

        // 평가 버튼 클릭
        document.getElementById('successBtn').onclick = () => {
            if (images.length === 0) return;
            selectedEvaluation = true;
            document.getElementById('successBtn').classList.add('selected');
            document.getElementById('failedBtn').classList.remove('selected');
            document.getElementById('submitBtn').disabled = false;
        };

        document.getElementById('failedBtn').onclick = () => {
            if (images.length === 0) return;
            selectedEvaluation = false;
            document.getElementById('failedBtn').classList.add('selected');
            document.getElementById('successBtn').classList.remove('selected');
            document.getElementById('submitBtn').disabled = false;
        };

        // 평가 제출
        document.getElementById('submitBtn').onclick = async () => {
            if (selectedEvaluation === null || images.length === 0) return;

            const currentImage = images[currentImageIndex];
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = '제출 중...';

            try {
                const response = await fetch('/api/synthesis-quality-test/submit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        result_log_idx: currentImage.idx,
                        is_success: selectedEvaluation
                    })
                });

                const data = await response.json();

                if (data.success) {
                    // 현재 이미지를 본 이미지 목록에 추가 (중복 방지)
                    viewedImageIds.add(currentImage.idx);
                    saveViewedImages();
                    
                    // 결과 표시
                    const resultMessage = document.getElementById('resultMessage');
                    resultMessage.textContent = selectedEvaluation ? '성공으로 평가되었습니다!' : '실패로 평가되었습니다.';
                    resultMessage.className = 'result-message ' + (selectedEvaluation ? 'success' : 'failed');
                    resultMessage.style.display = 'block';

                    // 버튼 상태 업데이트
                    if (selectedEvaluation) {
                        document.getElementById('successBtn').classList.add('success');
                        document.getElementById('successBtn').classList.remove('selected');
                    } else {
                        document.getElementById('failedBtn').classList.add('failed');
                        document.getElementById('failedBtn').classList.remove('selected');
                    }

                    document.getElementById('nextBtn').style.display = 'block';

                    // 통계 업데이트
                    totalEvaluated++;
                    if (selectedEvaluation) successCount++;
                    updateStats();
                    loadStatistics();
                } else {
                    alert(`평가 저장 실패: ${data.error || '알 수 없는 오류'}`);
                    submitBtn.disabled = false;
                    submitBtn.textContent = '평가 제출';
                }
            } catch (error) {
                console.error('평가 제출 오류:', error);
                alert(`평가 제출 중 오류가 발생했습니다: ${error.message}`);
                submitBtn.disabled = false;
                submitBtn.textContent = '평가 제출';
            }
        };

        // 다음 항목
        document.getElementById('nextBtn').onclick = () => {
            if (images.length === 0) return;
            
            // 다음 이미지로 이동
            currentImageIndex++;
            if (currentImageIndex >= images.length) {
                // 더 이상 이미지가 없으면 메시지 표시
                const imageContainer = document.getElementById('imageContainer');
                imageContainer.innerHTML = '<p style="text-align: center; color: #4caf50; padding: 40px; font-size: 1.2em;">✅ 모든 이미지를 평가했습니다!</p>';
            } else {
                loadCurrentImage();
            }
        };

        // 통계 업데이트
        function updateStats() {
            document.getElementById('totalCount').textContent = totalEvaluated;
            document.getElementById('currentIndex').textContent = images.length > 0 ? `${currentImageIndex + 1} / ${images.length}` : '0 / 0';
            document.getElementById('successCount').textContent = successCount;
            const rate = totalEvaluated > 0 ? ((successCount / totalEvaluated) * 100).toFixed(1) : 0;
            document.getElementById('successRate').textContent = `${rate}%`;
        }

        // 전체 통계 로드
        async function loadStatistics() {
            try {
                const params = new URLSearchParams();
                if (currentModel) params.append('model', currentModel);

                const response = await fetch(`/api/synthesis-quality-test/statistics?${params.toString()}`);
                const data = await response.json();

                if (data.success) {
                    // 헤더 통계 업데이트
                    document.getElementById('headerTotal').textContent = data.overall.total;
                    document.getElementById('headerSuccess').textContent = data.overall.success;
                    document.getElementById('headerRate').textContent = `${data.overall.success_rate}%`;

                    // 파이프라인별 통계 테이블 업데이트
                    const tbody = document.getElementById('pipelineStatsBody');
                    if (data.by_model && data.by_model.length > 0) {
                        tbody.innerHTML = data.by_model.map(model => `
                            <tr>
                                <td>${model.model}</td>
                                <td>${model.total}</td>
                                <td>${model.success}</td>
                                <td>${model.failed}</td>
                                <td><strong>${model.success_rate}%</strong></td>
                            </tr>
                        `).join('');
                    } else {
                        tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; padding: 20px;">평가 데이터가 없습니다.</td></tr>';
                    }
                }
            } catch (error) {
                console.error('통계 로드 오류:', error);
            }
        }

        // 페이지 로드 시 초기화
        window.addEventListener('DOMContentLoaded', () => {
            loadViewedImages(); // 본 이미지 목록 로드
            loadImages();
        });
    </script>
</body>

</html>