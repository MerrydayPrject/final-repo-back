<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>옷 합성 시스템 관리자 페이지</title>
    <link rel="stylesheet" href="/static/admin.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>

<body>
    <div class="admin-container">
        <!-- 로그 목록 -->
        <section class="logs-section">
            <div class="logs-header">
                <div class="logs-header-top">
                    <div style="display: flex; justify-content: space-between; align-items: center; width: 100%; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
                        <div class="tab-buttons" style="display: flex; gap: 10px; flex-wrap: wrap; flex: 1;">
                            <!-- 로그 탭 그룹 -->
                            <button id="tabSynthesis" class="tab-button active"
                                style="padding: 10px 20px; border: 1px solid #ddd; background: #007bff; color: #fff; cursor: pointer; border-radius: 5px;">
                                📋 합성 로그
                            </button>
                            <button id="tabBodyAnalysis" class="tab-button"
                                style="padding: 10px 20px; border: 1px solid #ddd; background: #fff; color: #333; cursor: pointer; border-radius: 5px;">
                                📊 분석 로그
                            </button>
                            <button id="tabReviews" class="tab-button"
                                style="padding: 10px 20px; border: 1px solid #ddd; background: #fff; color: #333; cursor: pointer; border-radius: 5px;">
                                ⭐ 리뷰 로그
                            </button>
                            <!-- 통계 탭 그룹 -->
                            <button id="tabSynthesisStats" class="tab-button"
                                style="padding: 10px 20px; border: 1px solid #ddd; background: #fff; color: #333; cursor: pointer; border-radius: 5px;">
                                📈 합성 통계
                            </button>
                            <button id="tabVisitorStats" class="tab-button"
                                style="padding: 10px 20px; border: 1px solid #ddd; background: #fff; color: #333; cursor: pointer; border-radius: 5px;">
                                👥 조회수 통계
                            </button>
                            <button id="tabCustomFitting" class="tab-button"
                                style="padding: 10px 20px; border: 1px solid #ddd; background: #fff; color: #333; cursor: pointer; border-radius: 5px;">
                                👔 커스텀피팅로그
                            </button>
                        <button id="tabProfileLogs" class="tab-button"
                            style="padding: 10px 20px; border: 1px solid #ddd; background: #fff; color: #333; cursor: pointer; border-radius: 5px;">
                            ⏱️ 피팅 프로파일링
                        </button>
                            <button id="tabDressFitting" class="tab-button"
                            style="padding: 10px 20px; border: 1px solid #ddd; background: #fff; color: #333; cursor: pointer; border-radius: 5px;">
                            👗 드레스 피팅 로그
                        </button>
                        <button id="tabUsageStats" class="tab-button"
                            style="padding: 10px 20px; border: 1px solid #ddd; background: #fff; color: #333; cursor: pointer; border-radius: 5px;">
                            📊 기능별 사용횟수
                        </button>
                        <button id="tabProcessingTimeStats" class="tab-button"
                            style="padding: 10px 20px; border: 1px solid #ddd; background: #fff; color: #333; cursor: pointer; border-radius: 5px;">
                            ⏱️ 처리시간 추이
                        </button>
                        </div>
                        <div class="logs-header-right" style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                            <div class="logs-count">
                                <span class="logs-count-label" id="logs-count-label">전체 합성:</span>
                                <span class="logs-count-value" id="logs-count">0</span>
                            </div>
                            <a href="/" class="btn-home">홈으로</a>
                        </div>
                    </div>
                    <h2 id="section-title">📋 합성 로그 목록</h2>
                </div>
                <!-- 검색 컨테이너 (합성 로그용) -->
                <div class="search-container" id="search-container-text">
                    <div class="search-box">
                        <input type="text" id="search-input" class="search-input" placeholder="모델명으로 검색..."
                            autocomplete="off">
                        <button class="search-button" id="search-button" onclick="handleSearch()">
                            🔍 검색
                        </button>
                        <button class="search-clear-button" id="search-clear-button" onclick="clearSearch()"
                            style="display: none;">
                            ✕ 초기화
                        </button>
                    </div>
                </div>
                <!-- 날짜 검색 컨테이너 (통계 탭용) -->
                <div class="search-container" id="search-container-date" style="display: none;">
                    <div class="search-box">
                        <input type="date" id="date-search-input" class="search-input" placeholder="날짜 선택..."
                            autocomplete="off">
                        <button class="search-button" id="date-search-button" onclick="handleDateSearch()">
                            🔍 검색
                        </button>
                        <button class="search-clear-button" id="date-search-clear-button" onclick="clearDateSearch()"
                            style="display: none;">
                            ✕ 초기화
                        </button>
                    </div>
                </div>
            </div>

            <!-- 합성 로그 목록 -->
            <div id="synthesis-logs-section">
                <div class="table-container">
                    <table class="logs-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>모델</th>
                                <th>처리 시간</th>
                                <th>상세보기</th>
                            </tr>
                        </thead>
                        <tbody id="logs-tbody">
                            <tr>
                                <td colspan="4" class="loading">데이터를 불러오는 중...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- 페이지네이션 -->
                <div class="pagination" id="pagination">
                    <!-- 동적으로 생성됨 -->
                </div>
            </div>

            <!-- 체형 분석 로그 목록 -->
            <div id="body-logs-section" style="display: none;">
                <div class="table-container">
                    <table class="logs-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>모델명</th>
                                <th>키 (cm)</th>
                                <th>몸무게 (kg)</th>
                                <th>BMI</th>
                                <th>체형 특징</th>
                                <th>걸린 시간</th>
                                <th>상세보기</th>
                            </tr>
                        </thead>
                        <tbody id="body-logs-tbody">
                            <tr>
                                <td colspan="8" class="loading">데이터를 불러오는 중...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- 페이지네이션 -->
                <div class="pagination" id="body-pagination">
                    <!-- 동적으로 생성됨 -->
                </div>
            </div>

            <!-- 리뷰 로그 목록 -->
            <div id="reviews-logs-section" style="display: none;">
                <div class="table-container">
                    <table class="logs-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>카테고리</th>
                                <th>별점</th>
                                <th>내용</th>
                                <th>작성일시</th>
                            </tr>
                        </thead>
                        <tbody id="reviews-logs-tbody">
                            <tr>
                                <td colspan="5" class="loading">데이터를 불러오는 중...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- 페이지네이션 -->
                <div class="pagination" id="reviews-pagination">
                    <!-- 동적으로 생성됨 -->
                </div>
            </div>

            <!-- 날짜별 합성 통계 -->
            <div id="synthesis-stats-section" style="display: none;">
                <div class="table-container">
                    <table class="logs-table">
                        <thead>
                            <tr>
                                <th>날짜</th>
                                <th>합성 카운트</th>
                            </tr>
                        </thead>
                        <tbody id="synthesis-stats-tbody">
                            <tr>
                                <td colspan="2" class="loading">데이터를 불러오는 중...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- 페이지네이션 -->
                <div class="pagination" id="synthesis-stats-pagination">
                    <!-- 동적으로 생성됨 -->
                </div>
            </div>

            <!-- 날짜별 조회수 통계 -->
            <div id="visitor-stats-section" style="display: none;">
                <div class="table-container">
                    <table class="logs-table">
                        <thead>
                            <tr>
                                <th>날짜</th>
                                <th>조회수</th>
                            </tr>
                        </thead>
                        <tbody id="visitor-stats-tbody">
                            <tr>
                                <td colspan="2" class="loading">데이터를 불러오는 중...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- 페이지네이션 -->
                <div class="pagination" id="visitor-stats-pagination">
                    <!-- 동적으로 생성됨 -->
                </div>
            </div>

            <!-- 커스텀 피팅 로그 목록 -->
            <div id="custom-fitting-logs-section" style="display: none;">
                <div class="table-container">
                    <table class="logs-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>생성일시</th>
                                <th>처리시간</th>
                                <th>의상 이미지</th>
                            </tr>
                        </thead>
                        <tbody id="custom-fitting-logs-tbody">
                            <tr>
                                <td colspan="4" class="loading">데이터를 불러오는 중...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- 페이지네이션 -->
                <div class="pagination" id="custom-fitting-pagination">
                    <!-- 동적으로 생성됨 -->
                </div>
            </div>

            <!-- 피팅 프로파일링 로그 목록 -->
            <div id="profile-logs-section" style="display: none;">
                <!-- 카테고리 필터 -->
                <div style="margin-bottom: 20px; display: flex; gap: 10px; align-items: center;">
                    <label style="font-weight: bold;">카테고리:</label>
                    <button id="profile-filter-general" class="profile-filter-btn active" onclick="filterProfileLogs('/tryon/compare')">
                        일반 피팅
                    </button>
                    <button id="profile-filter-custom" class="profile-filter-btn" onclick="filterProfileLogs('/tryon/compare/custom')">
                        커스텀 피팅
                    </button>
                </div>
                <div class="table-container">
                    <table class="logs-table">
                        <thead id="profile-logs-thead">
                            <tr>
                                <th>ID</th>
                                <th>카테고리</th>
                                <th>생성일시</th>
                                <th>인물사진 업로드&예외처리</th>
                                <th>드레스 드롭</th>
                                <th>리사이징</th>
                                <th>Gemini 호출</th>
                                <th>드레스 업로드 & 예외처리</th>
                                <th>누끼 처리</th>
                                <th>상세보기</th>
                            </tr>
                        </thead>
                        <tbody id="profile-logs-tbody">
                            <tr>
                                <td colspan="10" class="loading">데이터를 불러오는 중...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- 페이지네이션 -->
                <div class="pagination" id="profile-logs-pagination">
                    <!-- 동적으로 생성됨 -->
                </div>
            </div>

            <!-- 기능별 사용횟수 통계 -->
            <div id="usage-stats-section" style="display: none;">
                <div class="table-container">
                    <table class="logs-table">
                        <thead>
                            <tr>
                                <th>기능</th>
                                <th>사용횟수</th>
                            </tr>
                        </thead>
                        <tbody id="usage-stats-tbody">
                            <tr>
                                <td colspan="2" class="loading">데이터를 불러오는 중...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 처리시간 추이 통계 -->
            <div id="processing-time-stats-section" style="display: none;">
                <!-- 필터 컨트롤 -->
                <div style="margin-bottom: 20px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                    <div style="display: flex; flex-wrap: wrap; gap: 20px; align-items: center; margin-bottom: 15px;">
                        <div>
                            <label style="font-weight: bold; margin-right: 10px;">데이터 소스:</label>
                            <label style="margin-right: 15px;">
                                <input type="radio" name="data-source" value="result_logs" checked onchange="handleProcessingTimeFilterChange()">
                                result_logs (모델별)
                            </label>
                            <label style="margin-right: 15px;">
                                <input type="radio" name="data-source" value="tryon_profile" onchange="handleProcessingTimeFilterChange()">
                                tryon_profile
                            </label>
                        </div>
                        <div id="tryon-profile-group-by" style="display: none;">
                            <label style="font-weight: bold; margin-right: 10px;">그룹화:</label>
                            <label style="margin-right: 15px;">
                                <input type="radio" name="group-by" value="date" checked onchange="handleProcessingTimeFilterChange()">
                                날짜별
                            </label>
                            <label>
                                <input type="radio" name="group-by" value="model" onchange="handleProcessingTimeFilterChange()">
                                모델별
                            </label>
                        </div>
                        <div id="model-filter-container" style="display: block;">
                            <label style="font-weight: bold; margin-right: 10px;">모델:</label>
                            <select id="model-filter" onchange="handleProcessingTimeFilterChange()" style="padding: 5px 10px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="">전체</option>
                                <option value="general-fitting">일반 피팅</option>
                                <option value="custom-fitting">커스텀 피팅</option>
                            </select>
                        </div>
                        <div id="endpoint-filter-container" style="display: none;">
                            <label style="font-weight: bold; margin-right: 10px;">엔드포인트:</label>
                            <select id="endpoint-filter" onchange="handleProcessingTimeFilterChange()" style="padding: 5px 10px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="">전체</option>
                                <option value="/tryon/compare">일반 피팅</option>
                                <option value="/tryon/compare/custom">커스텀 피팅</option>
                            </select>
                        </div>
                    </div>
                    <div style="display: flex; flex-wrap: wrap; gap: 15px; align-items: center;">
                        <div>
                            <label style="font-weight: bold; margin-right: 10px;">시작 날짜:</label>
                            <input type="date" id="processing-time-start-date" onchange="handleProcessingTimeFilterChange()" 
                                style="padding: 5px 10px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div>
                            <label style="font-weight: bold; margin-right: 10px;">종료 날짜:</label>
                            <input type="date" id="processing-time-end-date" onchange="handleProcessingTimeFilterChange()" 
                                style="padding: 5px 10px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <button onclick="resetProcessingTimeFilters()" style="padding: 5px 15px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">
                            초기화
                        </button>
                    </div>
                </div>

                <!-- 통계 요약 -->
                <div id="processing-time-summary" style="margin-bottom: 20px; padding: 15px; background: #e7f3ff; border-radius: 8px; display: none;">
                    <div style="display: flex; gap: 30px; flex-wrap: wrap;">
                        <div>
                            <span style="font-weight: bold; margin-right: 10px;">최소:</span>
                            <span id="summary-min">-</span>초
                        </div>
                        <div>
                            <span style="font-weight: bold; margin-right: 10px;">최대:</span>
                            <span id="summary-max">-</span>초
                        </div>
                        <div>
                            <span style="font-weight: bold; margin-right: 10px;">평균:</span>
                            <span id="summary-avg">-</span>초
                        </div>
                    </div>
                </div>

                <!-- 차트 컨테이너 -->
                <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <canvas id="processing-time-chart" style="max-height: 500px;"></canvas>
                </div>

                <!-- 데이터 없음 메시지 -->
                <div id="processing-time-no-data" style="display: none; text-align: center; padding: 40px; color: #6c757d;">
                    <p>데이터가 없습니다.</p>
                </div>
            </div>

            <!-- 드레스 피팅 로그 목록 -->
            <div id="dress-fitting-logs-section" style="display: none;">
                <!-- 뷰 전환 버튼 -->
                <div style="margin-bottom: 20px; display: flex; gap: 10px; align-items: center;">
                    <label style="font-weight: bold;">뷰:</label>
                    <button id="dress-fitting-view-logs" class="profile-filter-btn active" onclick="switchDressFittingView('logs')">
                        개별 로그
                    </button>
                    <button id="dress-fitting-view-counts" class="profile-filter-btn" onclick="switchDressFittingView('counts')">
                        드레스별 카운트
                    </button>
                </div>
                
                <!-- 개별 로그 뷰 -->
                <div id="dress-fitting-logs-view" style="display: block;">
                    <div class="table-container">
                        <table class="logs-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>드레스 ID</th>
                                    <th>드레스 이미지</th>
                                    <th>스타일</th>
                                    <th>피팅 시각</th>
                                </tr>
                            </thead>
                            <tbody id="dress-fitting-logs-tbody">
                                <tr>
                                    <td colspan="5" class="loading">데이터를 불러오는 중...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- 페이지네이션 -->
                    <div class="pagination" id="dress-fitting-pagination">
                        <!-- 동적으로 생성됨 -->
                    </div>
                </div>
                
                <!-- 드레스별 카운트 뷰 -->
                <div id="dress-fitting-counts-view" style="display: none;">
                    <div class="table-container">
                        <table class="logs-table">
                            <thead>
                                <tr>
                                    <th>드레스 ID</th>
                                    <th>드레스 이미지</th>
                                    <th>드레스명</th>
                                    <th>스타일</th>
                                    <th>피팅 횟수</th>
                                    <th>최근 피팅 시각</th>
                                </tr>
                            </thead>
                            <tbody id="dress-fitting-counts-tbody">
                                <tr>
                                    <td colspan="6" class="loading">데이터를 불러오는 중...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- 페이지네이션 -->
                    <div class="pagination" id="dress-fitting-counts-pagination">
                        <!-- 동적으로 생성됨 -->
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- 로그 상세 모달 -->
    <div class="modal" id="detail-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>📝 로그 상세 정보</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- 동적으로 생성됨 -->
            </div>
        </div>
    </div>

    <script src="/static/common.js"></script>
    <script src="/static/admin_login.js"></script>
    <script src="/static/admin.js"></script>
</body>

</html>